<!-- Floor Table View -->
<div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Room</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tenant</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rent</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Bill</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bill Status</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Badge</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
            {% for snapshot in rooms_with_snapshot %}
            <tr class="hover:bg-gray-50 cursor-pointer transition-colors" 
                hx-get="{% url 'room_panel' snapshot.room.id %}"
                hx-target="#room-drawer-content"
                hx-swap="innerHTML"
                onclick="window.dispatchEvent(new CustomEvent('open-drawer'))">
                
                <!-- Room Number -->
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm font-medium text-gray-900">{{ snapshot.room.room_number }}</div>
                </td>
                
                <!-- Status -->
                <td class="px-6 py-4 whitespace-nowrap">
                    {% if snapshot.room.status == 'occupied' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            Occupied
                        </span>
                    {% elif snapshot.room.status == 'vacant' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-700">
                            Vacant
                        </span>
                    {% else %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                            Maintenance
                        </span>
                    {% endif %}
                </td>
                
                <!-- Tenant -->
                <td class="px-6 py-4 whitespace-nowrap">
                    {% if snapshot.tenant_name %}
                        <div class="text-sm text-gray-900">{{ snapshot.tenant_name }}</div>
                    {% else %}
                        <div class="text-sm text-gray-500 italic">No tenant</div>
                    {% endif %}
                </td>
                
                <!-- Rent -->
                <td class="px-6 py-4 whitespace-nowrap">
                    {% if snapshot.rent %}
                        <div class="text-sm text-gray-900">â‚¹{{ snapshot.rent|floatformat:0 }}</div>
                    {% else %}
                        <div class="text-sm text-gray-500">-</div>
                    {% endif %}
                </td>
                
                <!-- Last Bill Period -->
                <td class="px-6 py-4 whitespace-nowrap">
                    {% if snapshot.last_invoice_period %}
                        <div class="text-sm text-gray-900">{{ snapshot.last_invoice_period }}</div>
                        {% if snapshot.last_invoice_elec_units %}
                            <div class="text-xs text-gray-500">{{ snapshot.last_invoice_elec_units|floatformat:0 }} units</div>
                        {% endif %}
                    {% else %}
                        <div class="text-sm text-gray-500">-</div>
                    {% endif %}
                </td>
                
                <!-- Bill Status -->
                <td class="px-6 py-4 whitespace-nowrap">
                    {% if snapshot.last_invoice_status == 'paid' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                            Paid
                        </span>
                    {% elif snapshot.last_invoice_status == 'unpaid' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                            Unpaid
                        </span>
                    {% else %}
                        <div class="text-sm text-gray-500">-</div>
                    {% endif %}
                </td>
                
                <!-- Badge -->
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {{ snapshot.badge_class }}">
                        {{ snapshot.badge }}
                    </span>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="px-6 py-8 text-center text-gray-500">
                    No rooms on this floor.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
// Listen for custom event to open drawer
window.addEventListener('open-drawer', function() {
    // Find the Alpine.js component and set drawerOpen to true
    const buildingDetails = document.querySelector('[x-data]');
    if (buildingDetails && buildingDetails.__x) {
        buildingDetails.__x.$data.drawerOpen = true;
    }
});
</script>

